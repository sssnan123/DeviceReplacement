+-------------------------------------------------------------------------------------------------------------+
### Action Plan: Device Replacement: {{ inventory_hostname }} {{ device_model }} ###
+-------------------------------------------------------------------------------------------------------------+



1) Preparation Steps:

1.1) Dial in to the SEC bridge:

	# Inform TDO about the CHNGE and wait for his/her go-ahead.

	# Use the link below to log into the (eBay SEC) bridge
	# go/bridge

	# Change the status of the CR to "Ready to Start"

1.2) Get Device Console Access:

	# Log in to slc-nms-vm1 using your PET credentials,
	# Use the below commands to get console access of the devices.

	console -d {{ inventory_hostname }}

	# Log in to the device via console using your own login credentials when prompted.

1.3) Back up the configuration of all devices

	{% include "./temp/backup_configuration.txt" %}

1.4) Check traffic

	{% include "./temp/traffic.txt" %}

1.5) Global checks

	#######################################################################################
	# EXECUTE THE FOLLOWING GLOBAL CHECK COMMANDS FROM SSH ONLY, DO NOT EXECUTE ON CONSOLE.
	#######################################################################################

	# Perform mandatory global checks to determine device health and status prior to making any changes.

	{% include "./temp/global_checks.txt" %}

1.6) Put device {{ inventory_hostname }} in maintenance mode using:

	https://nseui.muse.vip.ebay.com/device-maintenance



2) Device cost-out for {{ inventory_hostname }}

2.1) Shut down hostlinks on {{ inventory_hostname }}

	# On {{ inventory_hostname }}:

	ping {{ chg_number }}

	{% include "./temp/disabling_host_links.txt" %}

	# If a rollback is needed refer to step 5.2 in rollback plan

2.2) Verify traffic has stopped on {{ inventory_hostname }}

	# Traffic:

	https://console.sherlock.io/d/zNLv2bKWz/switch-drill-down?var-Name={{ inventory_hostname }}&orgId=1&refresh=5m

	# On {{ inventory_hostname }}:

	show interfaces | match "Physical|rate"

2.3) Back up the configuration of the device

	# Back up the configuration of the device

	https://nseui.muse.vip.ebay.com/config-backup

	Enter device name: {{ inventory_hostname }} > Press Initiate Backup button

2.4) Shut down uplinks from upstream

	{% include "./temp/disabling_uplinks.txt" %}

	# If a rollback is needed refer to step 5.1 in rollback plan

2.5) Verify that device is unreachable

	# On rno1-nms-1:

	ssh {{ inventory_hostname }}
	ping {{ inventory_hostname }}

	# both should fail



3) Device Replacement for {{ inventory_hostname }}

	Inform TDO that you are about to replace {{ inventory_hostname }}

	# Ask SS to confirm the model of the new switch and it should be the same as the old failed one.
	# Ask SS to take picture of the new switch and send it on slack to confirm the model of the new switch.
	# Ask SS to disconnect all the links and replace the switch.

	# Once Site Services replaces the switch and has all the uplinks connected, turn one uplink back up.



4) Get the device config and OS

4.1) Unshut one uplink from upstream

	{% include "./temp/enabling_one_uplink.txt" %}

	# At this point please monitor the new switch through console to see the auto-build. Wait for the auto build to finish and then move to the next step.

	# If auto-build doesn't work, please follow the below link:

	https://wiki.vip.corp.ebay.com/display/IRT/Device+Manual+Build

4.2) Disable that one uplink and verify the health of the switch

	{% include "./temp/disabling_one_uplink.txt" %}

	# Monitor the health of the switch

	# On {{ inventory_hostname }}:

	show version invoke-on all-routing-engines | no-more
	show log messages | last 100 | no-more
	show chassis alarms | no-more
	show chassis fpc | no-more
	show chassis environment | no-more
	show configuration | display set | no-more



5) Device cost-in for {{ inventory_hostname }}

5.1) Unshut uplinks from upstream

	{% include "./temp/enabling_uplinks.txt" %}

	# If a rollback is needed refer to step 2.4 in rollback plan

5.2) Unshut hostlinks on {{ inventory_hostname }}

	# On {{ inventory_hostname }}:

	ping {{ chg_number }}

	{% include "./temp/enabling_host_links.txt" %}

	# If a rollback is needed refer to step 2.1 in rollback plan

5.3) Verify traffic has resumed on {{ inventory_hostname }}

	# Traffic:

	https://console.sherlock.io/d/zNLv2bKWz/switch-drill-down?var-Name={{ inventory_hostname }}&orgId=1&refresh=5m

	# On {{ inventory_hostname }}:

	show interfaces | match "Physical|rate"

5.4) Put device {{ inventory_hostname }} back to production mode using:

	https://nseui.muse.vip.ebay.com/device-maintenance



6) Global Checks

	# Perform mandatory post-checks to determine device health and status after changes have been made.

	{% include "./temp/global_checks.txt" %}
