---
- name: Get Device Info
  hosts: switch_name
  connection: network_cli
  vars:
    ansible_network_os: cisco.nxos.nxos
  vars_prompt:
    - name: chg_number
      prompt: "Please Enter the CHG number"
      private: no

  tasks:
    - name: Determine If Current Device Is Supported
      nxos_command:
        commands:
        - "show version"
      register: result

    - name: Get Output
      set_fact:
        device_info: "{{ result.stdout[0] | parse_cli_textfsm('./textfsm/device_info.textfsm') }}"

    - name: Extract Device Info
      set_fact:
        os_version: "{{ device_info[0].osVersion }}"
        device_model: "{{ device_info[0].deviceModel }}"

    - name: Get OS Version
      debug:
        var: os_version

    - name: Get Device Model
      debug:
        var: device_model

    - name: Unsupported Model
      fail: 
        msg: "Unsupported Model"
      when: "'Nexus 3048' != device_model"

    - name: Get Host Links
      import_tasks: GetInfo/host_links.yaml

    - name: Generate Host Links Management Procedure
      import_tasks: Procedure/host_links_management.yaml

    - name: Get Uplinks Group 
      import_tasks: GetInfo/uplinks.yaml

    - name: Generate Preparation Procedure
      import_tasks: Procedure/preparation.yaml

    - name: Generate Uplinks Management Procedure
      import_tasks: Procedure/uplinks_management.yaml

    - name: Generate Plans
      import_tasks: Post/plans.yaml

    - name: Post request
      import_tasks: Post/request.yaml
