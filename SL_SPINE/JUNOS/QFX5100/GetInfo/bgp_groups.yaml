---
- name: Get Output
  set_fact:
    bgp_groups: |-
      {%- set bgpGroupConfig = device_config.protocols.bgp.group -%}
      {%- set bgpGroups = [] -%}
      {%- for bgpGroup in bgpGroupConfig -%}
        {%- set groupName = bgpGroup["name"] -%}
        {%- set neighbors = bgpGroup["neighbor"] -%}
        {%- set peerAS = neighbors[0]["peer-as"] -%}
        {%- set members = [] -%}
        {%- for neighbor in neighbors -%}
          {%- set description = neighbor["description"] -%}
          {%- set name = neighbor["name"] -%}
          {%- set member = {"description": description, "name": name} -%}
          {%- set temp = members.append(member) -%}
        {%- endfor -%}
        {%- set group = {"groupName": groupName, "members": members, "peerAS": peerAS} -%}
        {%- set temp = bgpGroups.append(group) -%}
      {%- endfor -%}
      {{- bgpGroups -}}

- name: Print BGP Groups
  debug:
    var: bgp_groups
